{% extends "layout.html.jinja" %}
{% block title %}Library{% endblock %}
{% block page_title %}
<h1>My Library</h1>
{% endblock %}
{% block content %}
{% if user_session != None %}
<div class="pure-menu pure-menu-horizontal">
    <ul class="pure-menu-list">
        <li class="pure-menu-item">
            <button id="myPlaylistsBtn" class="pure-menu-link tab">My Playlists</button>
        </li>
        <li class="pure-menu-item">
            <button id="savedPlaylistsBtn" class="pure-menu-link tab">Saved Playlists</button>
        </li>
        <li class="pure-menu-item">
            <button id="randomPlaylistsBtn" class="pure-menu-link tab">Surprise Me</button>
        </li>
    </ul>
</div>
<div class="pure-u-1 pure-u-md-1-5 pure-u-lg-1-8 playlist-container">
    <form class="pure-form pure-u-1" method="GET" action="/edit-playlist">
        <button type="submit" class="playlist">
            <h1>+</h1>
        </button>
    </form>
</div>
<div id="myPlaylists">
    {# {% for playlist in myPlaylists %}
    {% include "playlistcard.html.jinja" ignore missing with context %}
    {% endfor %} #}
</div>
<div id="SavedPlaylists" style="display: none;">
    {# {% for playlist in savedPlaylists %}
    {% include "playlistcard.html.jinja" ignore missing with context %}
    {% endfor %} #}
</div>
<div id="RandomPlaylists" style="display: none;">
    {# {% for playlist in randomPlaylists %}
    {% include "playlistcard.html.jinja" ignore missing with context %}
    {% endfor %} #}
</div>
</div>

<script src="{{ url_for('static', filename='playlistCard.js') }}"></script>
<script>
    const user_id = "{{ user_id }}";
    var myPlaylists = {{ myPlaylists | tojson }};
    var savedPlaylists = {{ savedPlaylists | tojson }};
    var randomPlaylists = {{ randomPlaylists | tojson }};

    document.addEventListener("DOMContentLoaded", function () {
        const myPlaylistsBtn = document.getElementById("myPlaylistsBtn");
        const savedPlaylistsBtn = document.getElementById("savedPlaylistsBtn");
        const randomPlaylistsBtn = document.getElementById("randomPlaylistsBtn");

        setActiveButton(myPlaylistsBtn); // Highlight My Playlists button upon loading

        myPlaylistsBtn.addEventListener("click", function () {
            setActiveButton(myPlaylistsBtn);
            changeContentToMyPlaylists();
        });
        savedPlaylistsBtn.addEventListener("click", function () {
            setActiveButton(savedPlaylistsBtn);
            changeContentToSavedPlaylists();
        });
        randomPlaylistsBtn.addEventListener("click", function () {
            setActiveButton(randomPlaylistsBtn);
            changeContentToRandomPlaylists();
        });

        // Highlighting current tab stuff:
        document.body.addEventListener("click", function () {
            setActiveButton(document.querySelector(".tab.active"));
        });
        function setActiveButton(activeButton) {
            const buttons = [myPlaylistsBtn, savedPlaylistsBtn, randomPlaylistsBtn];
            buttons.forEach(button => {
                if (button === activeButton) {
                    button.classList.add("active");
                    button.style.backgroundColor = "white";
                } else {
                    button.classList.remove("active");
                    button.style.backgroundColor = ""; // Reset to original color
                }
            });
        }

        // This is NOT working. Do whatever will work. Dummy data is currently for myPlaylists
        function changeContentToMyPlaylists() {
            console.log("Clicked My Playlists tab");
            myPlaylists.forEach(function (playlist) {
                console.log(playlist);
                console.log(playlist.name);
                // const newDiv = document.createElement("div");
                // const newContent = document.createTextNode("Hi there and greetings!");
                // newDiv.appendChild(newContent);

                createPlaylistCard(playlist, user_id);
                x = document.getElementById("myPlaylists");
                x.appendChild(playlist);
            });
        }
        function changeContentToSavedPlaylists() {
            console.log("Clicked Saved Playlists tab");
            savedPlaylists.forEach(function (playlist) {
                createPlaylistCard(playlist, user_id);
            });
        }
        function changeContentToRandomPlaylists() {
            console.log("Clicked Random Playlists tab");
            randomPlaylists.forEach(function (playlist) {
                createPlaylistCard(playlist, user_id);
            });
        }
    });
</script>

{% else %}
<p>You can't access this page without logging in</p>
<a href="/login" class="pure-menu-link">Log in</a>
{% endif %}
{% endblock %}